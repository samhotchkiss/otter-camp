# Issue #116 â€” Local Install Blockers

> STATUS: NOT READY â€” Needs to move to 01-ready for Codex
> Context: Fresh OpenClaw + OtterCamp install on a Mac laptop. Everything local, no Railway. This documents every problem and exactly how to fix it.

## Test Scenario

Fresh MacBook. Install OpenClaw, then OtterCamp on top. No Railway, no `api.otter.camp`. Full stack on `localhost`.

---

## Fix 1: `make setup` â€” First-Run Bootstrap

**Problem:** There's no single command to go from `git clone` to working app. User has to manually create `.env`, start Docker, run migrations, figure out auth, generate tokens â€” all undocumented.

**Implementation:**

### 1a. Create `scripts/setup.sh`

```bash
#!/usr/bin/env bash
set -euo pipefail

BOLD='\033[1m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
RED='\033[0;31m'
NC='\033[0m'

echo -e "${BOLD}ðŸ¦¦ Otter Camp Setup${NC}"
echo ""

# --- Check prerequisites ---
check_cmd() {
    if ! command -v "$1" &> /dev/null; then
        echo -e "${RED}âœ— $1 not found. Please install $1.${NC}"
        exit 1
    fi
    echo -e "${GREEN}âœ“${NC} $1 found"
}

check_cmd go
check_cmd node
check_cmd git

# Check for Docker OR local Postgres
if command -v docker &> /dev/null; then
    echo -e "${GREEN}âœ“${NC} docker found"
    USE_DOCKER=true
elif command -v psql &> /dev/null; then
    echo -e "${YELLOW}!${NC} docker not found, using local postgres"
    USE_DOCKER=false
else
    echo -e "${RED}âœ— Neither docker nor psql found. Install Docker or PostgreSQL.${NC}"
    exit 1
fi

# --- Create .env if missing ---
if [ ! -f .env ]; then
    echo ""
    echo "Creating .env from .env.example..."
    
    # Generate random secrets
    SYNC_TOKEN=$(openssl rand -base64 32 | tr -d '/+=' | head -c 32)
    WS_SECRET=$(openssl rand -base64 32 | tr -d '/+=' | head -c 32)
    WEBHOOK_SECRET=$(openssl rand -base64 32 | tr -d '/+=' | head -c 32)
    AUTH_TOKEN=$(openssl rand -base64 32 | tr -d '/+=' | head -c 32)
    
    cat > .env << EOF
# Generated by make setup â€” $(date)
PORT=8080
DATABASE_URL=postgres://otter:camp@localhost:5432/ottercamp?sslmode=disable
OPENCLAW_WEBHOOK_SECRET=${WEBHOOK_SECRET}
OPENCLAW_WS_SECRET=${WS_SECRET}
OPENCLAW_SYNC_TOKEN=${SYNC_TOKEN}
OPENCLAW_AUTH_SECRET=${AUTH_TOKEN}
VITE_API_URL=http://localhost:8080
GIT_REPO_ROOT=./data/repos
# Local auth â€” auto-generated token, no OpenClaw needed
LOCAL_AUTH_TOKEN=oc_local_${SYNC_TOKEN}
EOF
    echo -e "${GREEN}âœ“${NC} .env created with generated secrets"
else
    echo -e "${GREEN}âœ“${NC} .env already exists"
fi

# Source .env for later use
set -a; source .env; set +a

# --- Start Postgres ---
if [ "$USE_DOCKER" = true ]; then
    echo ""
    echo "Starting Postgres..."
    docker-compose up -d postgres 2>/dev/null || docker compose up -d postgres 2>/dev/null
    # Wait for healthy
    echo "Waiting for Postgres to be ready..."
    for i in $(seq 1 30); do
        if docker exec otter-camp-db pg_isready -U otter -d ottercamp &>/dev/null; then
            break
        fi
        sleep 1
    done
    echo -e "${GREEN}âœ“${NC} Postgres running"
fi

# --- Create data directories ---
mkdir -p data/repos
echo -e "${GREEN}âœ“${NC} data/repos directory created"

# --- Run migrations ---
echo ""
echo "Running database migrations..."
go run ./scripts/migrate/migrate.go up
echo -e "${GREEN}âœ“${NC} Migrations applied"

# --- Install frontend dependencies ---
echo ""
echo "Installing frontend dependencies..."
cd web && npm ci --silent && cd ..
echo -e "${GREEN}âœ“${NC} Frontend dependencies installed"

# --- Seed default org + user ---
echo ""
echo "Seeding default workspace..."
go run ./scripts/seed/seed.go
echo -e "${GREEN}âœ“${NC} Default workspace created"

# --- Write CLI config ---
OTTER_CONFIG_DIR="${HOME}/Library/Application Support/otter"
if [ "$(uname)" != "Darwin" ]; then
    OTTER_CONFIG_DIR="${HOME}/.config/otter"
fi
mkdir -p "${OTTER_CONFIG_DIR}"
cat > "${OTTER_CONFIG_DIR}/config.json" << EOF
{
  "apiBaseUrl": "http://localhost:8080",
  "token": "${LOCAL_AUTH_TOKEN}",
  "defaultOrg": ""
}
EOF
echo -e "${GREEN}âœ“${NC} CLI config written to ${OTTER_CONFIG_DIR}/config.json"

# --- Create bridge .env if missing ---
if [ ! -f bridge/.env ]; then
    cat > bridge/.env << EOF
# Generated by make setup
OPENCLAW_HOST=127.0.0.1
OPENCLAW_PORT=18791
OPENCLAW_TOKEN=your-openclaw-gateway-token-here
OTTERCAMP_URL=http://localhost:8080
OTTERCAMP_TOKEN=${SYNC_TOKEN}
OPENCLAW_WS_SECRET=${WS_SECRET}
EOF
    echo -e "${GREEN}âœ“${NC} bridge/.env created (edit OPENCLAW_TOKEN to match your gateway)"
fi

# --- Print summary ---
echo ""
echo -e "${BOLD}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${BOLD}ðŸ¦¦ Setup complete!${NC}"
echo -e "${BOLD}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
echo -e "  Run ${BOLD}make dev${NC} to start development servers."
echo ""
echo -e "  Then open: ${BOLD}http://localhost:5173${NC}"
echo ""
echo -e "  Auth token: ${BOLD}${LOCAL_AUTH_TOKEN}${NC}"
echo -e "  (Auto-configured in CLI. Browser will auto-login in dev mode.)"
echo ""
echo -e "  Bridge: edit ${BOLD}bridge/.env${NC} with your OpenClaw gateway token,"
echo -e "  then run: ${BOLD}npx tsx bridge/openclaw-bridge.ts --continuous${NC}"
echo ""
```

### 1b. Add to Makefile

```makefile
setup:
	@bash scripts/setup.sh

seed:
	@go run ./scripts/seed/seed.go
```

### 1c. Create `scripts/seed/seed.go`

This creates the default org, user, and auth session on first run:

```go
package main

import (
    "database/sql"
    "fmt"
    "log"
    "os"
    "strings"
    
    _ "github.com/lib/pq"
)

func main() {
    dbURL := os.Getenv("DATABASE_URL")
    if dbURL == "" {
        dbURL = "postgres://otter:camp@localhost:5432/ottercamp?sslmode=disable"
    }
    
    db, err := sql.Open("postgres", dbURL)
    if err != nil {
        log.Fatalf("failed to connect: %v", err)
    }
    defer db.Close()
    
    // Check if org already exists
    var count int
    db.QueryRow("SELECT COUNT(*) FROM organizations").Scan(&count)
    if count > 0 {
        fmt.Println("Workspace already exists, skipping seed.")
        return
    }
    
    // Create default org
    var orgID string
    err = db.QueryRow(`
        INSERT INTO organizations (name, slug) 
        VALUES ('My Workspace', 'my-workspace')
        RETURNING id
    `).Scan(&orgID)
    if err != nil {
        log.Fatalf("failed to create org: %v", err)
    }
    fmt.Printf("Created org: %s (id: %s)\n", "My Workspace", orgID)
    
    // Create default user
    var userID string
    err = db.QueryRow(`
        INSERT INTO users (org_id, display_name, email, subject, issuer)
        VALUES ($1, 'Admin', 'admin@localhost', 'local-admin', 'otter.camp')
        RETURNING id
    `, orgID).Scan(&userID)
    if err != nil {
        log.Fatalf("failed to create user: %v", err)
    }
    fmt.Printf("Created user: Admin (id: %s)\n", userID)
    
    // Create auth session with the LOCAL_AUTH_TOKEN from env
    token := os.Getenv("LOCAL_AUTH_TOKEN")
    if token == "" {
        token = "oc_local_" + randomString(32)
    }
    
    _, err = db.Exec(`
        INSERT INTO sessions (org_id, user_id, token, expires_at)
        VALUES ($1, $2, $3, NOW() + INTERVAL '365 days')
    `, orgID, userID, token)
    if err != nil {
        log.Fatalf("failed to create session: %v", err)
    }
    fmt.Printf("Auth token: %s\n", token)
    
    // Write org ID back to .env for CLI
    fmt.Printf("Org ID: %s\n", orgID)
}

func randomString(n int) string {
    // crypto/rand implementation
    b := make([]byte, n)
    _, _ = rand.Read(b)
    return base64.RawURLEncoding.EncodeToString(b)[:n]
}
```

**Files to create:**
- `scripts/setup.sh`
- `scripts/seed/seed.go`

**Files to modify:**
- `Makefile` â€” add `setup` and `seed` targets

---

## Fix 2: Local Auth (File-Based, No Magic Links)

**Problem:** Auth requires either OpenClaw OAuth (chicken-and-egg) or magic links (hidden env var). For local, auth should be dead simple: a file with a token.

**How it works:**

The `make setup` script generates a `LOCAL_AUTH_TOKEN` and stores it in three places:
1. `.env` file (server reads it)
2. CLI config (`~/Library/Application Support/otter/config.json`)
3. Database `sessions` table (so the server validates it)

No magic links, no OAuth, no OpenClaw dependency for auth.

### Server-Side: Accept LOCAL_AUTH_TOKEN

**File: `internal/api/auth.go`**

Add to the `HandleValidateToken` function (around line 632):

```go
// Check for local auth token (file-based, no OpenClaw needed)
if localToken := strings.TrimSpace(os.Getenv("LOCAL_AUTH_TOKEN")); localToken != "" {
    if token == localToken {
        // Look up session by token
        // (already seeded by make setup)
        // ... existing session lookup code works as-is
    }
}
```

Actually, this should already work â€” the seed script creates a real session row with the token. The existing `HandleValidateToken` code looks up sessions by token. As long as the token is in the `sessions` table with a valid `expires_at`, it just works.

**The only change needed:** Make sure `HandleValidateToken` doesn't require `OTTERCAMP_ALLOW_INSECURE_MAGIC_AUTH` for `oc_local_*` tokens. Currently line 642 checks:

```go
if strings.HasPrefix(token, "oc_magic_") && allowInsecureMagicTokenValidation() {
```

Add a parallel check:
```go
if strings.HasPrefix(token, "oc_local_") {
    // Local auth tokens are always valid â€” they're in the sessions table
    // with a real org_id and user_id from the seed script.
    // Fall through to normal session lookup.
}
```

Or better: just look up the token in the sessions table regardless of prefix. If it's there and not expired, it's valid.

### Frontend: Auto-Login in Dev

**File: `web/src/components/AuthHandler.tsx`**

When `VITE_API_URL` points to localhost (or is unset in dev), check for stored token or auto-detect:

```typescript
// On mount, check if we have a local auth token
useEffect(() => {
  const params = new URLSearchParams(window.location.search);
  const authParam = params.get('auth');
  
  if (authParam) {
    // Token passed via URL (from make setup output)
    localStorage.setItem('otter_camp_token', authParam);
    window.history.replaceState({}, '', '/');
    return;
  }
  
  // If no token and we're on localhost, try to auto-discover
  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
    const stored = localStorage.getItem('otter_camp_token');
    if (!stored) {
      // Show a simple "paste your token" input instead of the full OAuth flow
      setShowLocalLogin(true);
    }
  }
}, []);
```

### CLI: Default to Localhost

**File: `internal/ottercli/config.go`**

Change line 11:
```go
// Before:
const defaultAPIBaseURL = "https://api.otter.camp"

// After:
const defaultAPIBaseURL = "http://localhost:8080"
```

The CLI should assume local by default. Users connecting to a hosted instance can `otter auth login --url https://api.otter.camp`.

**Files to modify:**
- `internal/api/auth.go` â€” ensure `oc_local_*` tokens validate via normal session lookup
- `web/src/components/AuthHandler.tsx` â€” handle `?auth=` param, local login UX
- `internal/ottercli/config.go` â€” change default to `http://localhost:8080`

---

## Fix 3: Centralize API_URL in Frontend

**Problem:** 30+ files each independently declare `const API_URL = import.meta.env.VITE_API_URL || 'https://api.otter.camp'`. If the env var isn't set, they silently talk to production.

**Implementation:**

### 3a. Single source of truth

**File: `web/src/lib/api.ts`** (already exists, already has `API_URL`)

This file already exports `apiFetch`. It should also export `API_URL`:

```typescript
// web/src/lib/api.ts
export const API_URL = import.meta.env.VITE_API_URL || window.location.origin;
```

The fallback is `window.location.origin` (not `https://api.otter.camp`). If you're running on `localhost:5173`, API calls go to `localhost:5173` (which Vite proxies to `:8080`). If you're running the production build served by Go on `:8080`, API calls go to `:8080`. If you're on `sam.otter.camp`, they go to `sam.otter.camp`.

### 3b. Replace all 30+ declarations

Every file that currently has its own `const API_URL = ...` line needs to be changed to:

```typescript
import { API_URL } from '../lib/api';  // adjust relative path
```

**Files to modify** (complete list):
```
web/src/contexts/GlobalChatContext.tsx
web/src/contexts/AuthContext.tsx
web/src/contexts/NotificationContext.tsx
web/src/components/AuthHandler.tsx
web/src/components/chat/GlobalChatDock.tsx
web/src/components/chat/GlobalChatSurface.tsx
web/src/components/activity/ActivityPanel.tsx
web/src/components/TaskDetail.tsx              â† also fix hardcoded apiEndpoint default
web/src/components/agents/AgentIdentityEditor.tsx
web/src/components/agents/AgentMemoryBrowser.tsx
web/src/components/agents/AddAgentModal.tsx
web/src/components/project/ProjectIssuesList.tsx
web/src/components/project/ProjectChatPanel.tsx
web/src/components/project/ProjectCommitBrowser.tsx
web/src/components/project/ProjectFileBrowser.tsx
web/src/components/project/IssueThreadPanel.tsx
web/src/components/messaging/DMConversationView.tsx
web/src/hooks/useAgentActivity.ts
web/src/pages/AgentDetailPage.tsx
web/src/pages/ProjectsPage.tsx                 â† also fix hardcoded apiEndpoint default
web/src/pages/ProjectDetailPage.tsx
web/src/pages/AgentsPage.tsx
web/src/pages/WorkflowsPage.tsx
web/src/pages/OrgPickerPage.tsx
web/src/pages/FeedPage.tsx
```

### 3c. Fix hardcoded API endpoints

**`web/src/components/TaskDetail.tsx` line 503:**
```typescript
// Before:
apiEndpoint = "https://api.otter.camp/api/tasks"
// After:
apiEndpoint = `${API_URL}/api/tasks`
```

**`web/src/pages/ProjectsPage.tsx` line 272:**
```typescript
// Before:
apiEndpoint = "https://api.otter.camp/api/projects"
// After:
apiEndpoint = `${API_URL}/api/projects`
```

---

## Fix 4: Remove Redis from docker-compose

**Problem:** Redis container starts but zero Go code imports or uses Redis. Wastes resources and confuses new users.

**Implementation:**

**File: `docker-compose.yml`**

Remove the entire `redis` service block and `redis_data` volume. Keep it simple â€” just Postgres.

```yaml
services:
  postgres:
    image: postgres:16-alpine
    # ... (keep as-is)

volumes:
  postgres_data:
  # redis_data: â† remove
```

Also remove `REDIS_URL` from `.env.example`.

---

## Fix 5: Fix Git Repo Storage Path

**Problem:** `internal/store/project_repo_storage.go` defaults to `/data/repos` (absolute path, Docker-only). On a Mac without Docker, the user can't write to `/data/repos`.

**Implementation:**

**File: `internal/store/project_repo_storage.go` line 16:**
```go
// Before:
const defaultGitRepoRoot = "/data/repos"

// After:
const defaultGitRepoRoot = "./data/repos"
```

This matches the other two defaults in `config.go` and `repo_clone_manager.go`.

The `make setup` script already creates `./data/repos/`.

---

## Fix 6: Create `bridge/.env.example`

**Problem:** No template for bridge env vars. Users have to read source code.

**Implementation:**

Create `bridge/.env.example`:

```bash
# OpenClaw Bridge Configuration
# Copy to bridge/.env and fill in your values

# Local OpenClaw Gateway
OPENCLAW_HOST=127.0.0.1
OPENCLAW_PORT=18791
OPENCLAW_TOKEN=your-openclaw-gateway-token

# Otter Camp API (local)
OTTERCAMP_URL=http://localhost:8080
OTTERCAMP_TOKEN=your-sync-token-from-env
OPENCLAW_WS_SECRET=your-ws-secret-from-env

# Note: OTTERCAMP_TOKEN must match OPENCLAW_SYNC_TOKEN in the server .env
# Note: OPENCLAW_WS_SECRET must match the server's OPENCLAW_WS_SECRET
# These are auto-generated by 'make setup'
```

---

## Fix 7: WebSocket Origin Checking

**Problem:** `internal/ws/handler.go` only allows `localhost` and `127.0.0.1`. Accessing via LAN IP (phone testing) fails.

**Implementation:**

**File: `internal/ws/handler.go` around line 248:**

```go
// Add development mode check
func isAllowedOrigin(origin string) bool {
    // In development, allow all origins
    env := strings.ToLower(os.Getenv("APP_ENV"))
    if env == "" || env == "development" || env == "dev" || env == "local" {
        return true
    }
    
    // Check configured origins
    if allowed := os.Getenv("WS_ALLOWED_ORIGINS"); allowed != "" {
        for _, o := range strings.Split(allowed, ",") {
            if strings.TrimSpace(o) == origin {
                return true
            }
        }
    }
    
    // Default allowlist
    allowedHosts := map[string]bool{
        "localhost": true,
        "127.0.0.1": true,
    }
    // ... existing logic
}
```

---

## Fix 8: Single-Port Production Mode

**Problem:** Unclear how to run the full stack from one port (Go serves frontend + API).

**Implementation:**

Add to Makefile:

```makefile
# Build and run everything from a single port (no Vite dev server)
prod-local:
	cd web && VITE_API_URL= npm run build
	STATIC_DIR=./web/dist go run ./cmd/server
```

And document in README:

```markdown
### Single-Port Mode (Production-Like)

To run everything from one port (no separate frontend server):

    make prod-local

This builds the frontend and serves it from the Go server at http://localhost:8080.
```

---

## Fix 9: Update README Quick Start

Replace the current Quick Start section with:

```markdown
## Quick Start

### Prerequisites
- Go 1.24+
- Node.js 20+
- Docker (or local PostgreSQL 15+)
- Git

### Setup

    git clone https://github.com/samhotchkiss/otter-camp.git
    cd otter-camp
    make setup

This will:
- Check prerequisites
- Create `.env` with generated secrets
- Start PostgreSQL (Docker)
- Run database migrations
- Create your workspace and admin account
- Configure the CLI
- Print your auth token

### Run

    make dev

Open http://localhost:5173 in your browser.

### Connect OpenClaw

1. Edit `bridge/.env` with your OpenClaw gateway token
2. Run the bridge:

       npx tsx bridge/openclaw-bridge.ts --continuous

Your agents will appear in OtterCamp within 30 seconds.
```

---

## Complete File List

### New Files
- `scripts/setup.sh` â€” first-run bootstrap script
- `scripts/seed/seed.go` â€” database seeder (org + user + session)
- `bridge/.env.example` â€” bridge config template

### Modified Files
- `Makefile` â€” add `setup`, `seed`, `prod-local` targets
- `docker-compose.yml` â€” remove Redis
- `.env.example` â€” remove `REDIS_URL`, add `LOCAL_AUTH_TOKEN`, add `GIT_REPO_ROOT`
- `internal/api/auth.go` â€” ensure `oc_local_*` tokens validate normally
- `internal/ottercli/config.go` â€” change default API URL to `http://localhost:8080`
- `internal/store/project_repo_storage.go` â€” change default from `/data/repos` to `./data/repos`
- `internal/ws/handler.go` â€” allow all origins in development mode
- `web/src/lib/api.ts` â€” export `API_URL` with `window.location.origin` fallback
- `web/src/components/AuthHandler.tsx` â€” handle `?auth=` URL param for local login
- `web/src/components/TaskDetail.tsx` â€” remove hardcoded `api.otter.camp` endpoint
- `web/src/pages/ProjectsPage.tsx` â€” remove hardcoded `api.otter.camp` endpoint
- 25+ frontend files â€” replace local `API_URL` const with import from `lib/api`
- `README.md` â€” update Quick Start section

## Implementation Order

All fixes are independent â€” Codex can do them in any order or in parallel. But if sequencing:
1. Fix 1 (`make setup` + seed) + Fix 2 (auth) â€” unblocks login
2. Fix 3 (API_URL) â€” prevents wrong-server bugs
3. Fixes 4-6 (Redis, git path, bridge env) â€” cleanup
4. Fixes 7-9 (WebSocket, prod mode, README) â€” polish

## Execution Log

- [2026-02-09 13:06 MST] Issue #n/a | Commit n/a | moved-to-in-progress | Moved spec 116 from 01-ready to 02-in-progress and created branch codex/spec-116-local-install-blockers from origin/main | Tests: n/a
- [2026-02-09 13:09 MST] Issue #478 | Commit n/a | created | Planned setup bootstrap + seed implementation issue with explicit tests | Tests: n/a (issue creation)
- [2026-02-09 13:09 MST] Issue #479 | Commit n/a | created | Planned local token auth/API + AuthHandler issue with explicit tests | Tests: n/a (issue creation)
- [2026-02-09 13:09 MST] Issue #480 | Commit n/a | created | Planned shared frontend API_URL migration for contexts/components with explicit tests | Tests: n/a (issue creation)
- [2026-02-09 13:09 MST] Issue #481 | Commit n/a | created | Planned page-level API_URL migration and hardcoded endpoint removal with explicit tests | Tests: n/a (issue creation)
- [2026-02-09 13:09 MST] Issue #482 | Commit n/a | created | Planned Redis removal from local compose/env defaults with explicit tests | Tests: n/a (issue creation)
- [2026-02-09 13:09 MST] Issue #483 | Commit n/a | created | Planned local-relative git repo root default change with explicit tests | Tests: n/a (issue creation)
- [2026-02-09 13:09 MST] Issue #484 | Commit n/a | created | Planned bridge .env.example template addition with explicit checks | Tests: n/a (issue creation)
- [2026-02-09 13:09 MST] Issue #485 | Commit n/a | created | Planned websocket development-mode origin policy update with explicit tests | Tests: n/a (issue creation)
- [2026-02-09 13:09 MST] Issue #486 | Commit n/a | created | Planned make prod-local single-port mode addition with explicit tests | Tests: n/a (issue creation)
- [2026-02-09 13:09 MST] Issue #487 | Commit n/a | created | Planned README quick-start local-first rewrite with explicit checks | Tests: n/a (issue creation)
- [2026-02-09 13:13 MST] Issue #478 | Commit 7bdcf35 | committed+pushed | Added local setup bootstrap script, seed command, and Makefile setup/seed targets on branch codex/spec-116-local-install-blockers | Tests: make -n setup; bash -n scripts/setup.sh; go test ./scripts/seed -count=1; go test ./cmd/migrate -count=1
- [2026-02-09 13:13 MST] Issue #478 | Commit 7bdcf35 | closed | Closed GitHub issue with implementation summary and test evidence; noted pre-existing internal/api compile failures | Tests: go test ./internal/api -run 'TestHandleValidateToken' -count=1 (pre-existing compile failures)
- [2026-02-09 13:13 MST] Issue #n/a | Commit 7bdcf35 | pr-opened | Opened draft PR #488 for spec-116 branch visibility | Tests: n/a
- [2026-02-09 13:15 MST] Issue #479 | Commit 2fc01ec | committed+pushed | Updated AuthHandler local token persistence/query cleanup and added auth bypass guard helper tests | Tests: cd web && npm run test -- --run src/components/AuthHandler.test.tsx src/contexts/__tests__/AuthContext.test.tsx
- [2026-02-09 13:15 MST] Issue #479 | Commit 2fc01ec | closed | Closed GitHub issue with implementation summary and test evidence; noted pre-existing internal/api compile failures | Tests: go test ./internal/api -run 'TestHandleValidateToken|TestAllowInsecureMagicTokenValidationEnvAliases|TestShouldBypassDBTokenValidation' -count=1 (pre-existing compile failures)
- [2026-02-09 13:18 MST] Issue #480 | Commit 8326972 | committed+pushed | Centralized shared API_URL export and migrated contexts/components/hooks to import from lib/api | Tests: cd web && npm run test -- --run src/lib/api.test.ts src/contexts/GlobalChatContext.test.tsx src/components/chat/GlobalChatSurface.test.tsx src/components/chat/GlobalChatDock.test.tsx src/components/activity/__tests__/ActivityPanel.test.tsx src/components/project/ProjectFileBrowser.test.tsx src/components/project/ProjectCommitBrowser.test.tsx src/components/project/ProjectChatPanel.test.tsx src/components/project/IssueThreadPanel.test.tsx src/components/agents/AgentIdentityEditor.test.tsx src/components/agents/AgentMemoryBrowser.test.tsx src/components/agents/AddAgentModal.test.tsx src/components/messaging/__tests__/DMConversationView.test.tsx src/hooks/useAgentActivity.test.ts
- [2026-02-09 13:18 MST] Issue #480 | Commit 8326972 | closed | Closed GitHub issue with commit/test evidence for shared API_URL migration slice | Tests: cd web && npm run test -- --run src/lib/api.test.ts src/contexts/GlobalChatContext.test.tsx src/components/chat/GlobalChatSurface.test.tsx src/components/chat/GlobalChatDock.test.tsx src/components/activity/__tests__/ActivityPanel.test.tsx src/components/project/ProjectFileBrowser.test.tsx src/components/project/ProjectCommitBrowser.test.tsx src/components/project/ProjectChatPanel.test.tsx src/components/project/IssueThreadPanel.test.tsx src/components/agents/AgentIdentityEditor.test.tsx src/components/agents/AgentMemoryBrowser.test.tsx src/components/agents/AddAgentModal.test.tsx src/components/messaging/__tests__/DMConversationView.test.tsx src/hooks/useAgentActivity.test.ts
- [2026-02-09 13:22 MST] Issue #481 | Commit 1bea8f5 | committed+pushed | Migrated remaining page-level API_URL usage and removed hardcoded TaskDetail/ProjectsPage hosted defaults | Tests: cd web && npm run test -- --run src/pages/FeedPage.test.tsx src/pages/ProjectDetailPage.test.tsx src/pages/ProjectsPage.test.tsx src/pages/AgentDetailPage.test.tsx src/pages/AgentsPage.test.tsx src/components/__tests__/TaskDetail.test.tsx
- [2026-02-09 13:22 MST] Issue #481 | Commit 1bea8f5 | closed | Closed GitHub issue with commit/test evidence for page API URL and endpoint-default cleanup | Tests: rg -n 'https://api\.otter\.camp/api/(tasks|projects)|const API_URL = import\.meta\.env\.VITE_API_URL \|\| "https://api\.otter\.camp"|const API_URL = import\.meta\.env\.VITE_API_URL \|\| '\''https://api\.otter\.camp'\''' web/src/pages web/src/components/TaskDetail.tsx
- [2026-02-09 13:23 MST] Issue #482 | Commit ef16c59 | committed+pushed | Removed Redis service/dependencies from docker-compose and REDIS_URL defaults from .env.example | Tests: rg -n 'redis:|REDIS_URL|redis_data' docker-compose.yml .env.example
- [2026-02-09 13:23 MST] Issue #482 | Commit ef16c59 | closed | Closed GitHub issue with commit/test evidence; docker compose config verification blocked because docker binary unavailable | Tests: docker compose config (blocked: docker not installed)
- [2026-02-09 13:26 MST] Issue #483 | Commit f305fab | committed+pushed | Switched default project repo root to ./data/repos and added gitRepoRoot default/override tests | Tests: rg -n 'defaultGitRepoRoot' internal/store/project_repo_storage.go internal/store/project_repo_storage_test.go
- [2026-02-09 13:26 MST] Issue #483 | Commit f305fab | closed | Closed GitHub issue with commit/test evidence; internal/store package tests remain blocked by pre-existing project_issue_store_test compile failures | Tests: go test ./internal/store -run 'TestGitRepoRoot_Default|TestGitRepoRoot_UsesEnvOverride' -count=1 (pre-existing compile failures)
- [2026-02-09 13:27 MST] Issue #484 | Commit 17a5e01 | committed+pushed | Added bridge/.env.example template with required local bridge variables and notes | Tests: rg -n 'OPENCLAW_HOST|OPENCLAW_PORT|OPENCLAW_TOKEN|OTTERCAMP_URL|OTTERCAMP_TOKEN|OPENCLAW_WS_SECRET' bridge/.env.example bridge/openclaw-bridge.ts
- [2026-02-09 13:27 MST] Issue #484 | Commit 17a5e01 | closed | Closed GitHub issue with commit/test evidence for bridge env template | Tests: rg -n 'OPENCLAW_HOST|OPENCLAW_PORT|OPENCLAW_TOKEN|OTTERCAMP_URL|OTTERCAMP_TOKEN|OPENCLAW_WS_SECRET' bridge/.env.example bridge/openclaw-bridge.ts
- [2026-02-09 13:28 MST] Issue #485 | Commit 00cd082 | committed+pushed | Added APP_ENV-based websocket origin mode to allow cross-origin in local/dev and preserve strict production checks | Tests: go test ./internal/ws -run 'TestIsWebSocketOriginAllowed' -count=1; go test ./internal/ws -count=1
- [2026-02-09 13:28 MST] Issue #485 | Commit 00cd082 | closed | Closed GitHub issue with commit/test evidence for websocket development origin policy | Tests: go test ./internal/ws -run 'TestIsWebSocketOriginAllowed' -count=1; go test ./internal/ws -count=1
- [2026-02-09 13:30 MST] Issue #486 | Commit 99eb1c3 | committed+pushed | Added make prod-local target for single-port local build+serve mode | Tests: make -n prod-local; cd web && VITE_API_URL= npm run build
- [2026-02-09 13:30 MST] Issue #486 | Commit 99eb1c3 | closed | Closed GitHub issue and added follow-up escaped comment with full test evidence after shell-substitution glitch in initial close comment | Tests: make -n prod-local; cd web && VITE_API_URL= npm run build
- [2026-02-09 13:31 MST] Issue #487 | Commit a869a3a | committed+pushed | Rewrote README Quick Start to local-first setup/run/bridge flow and documented single-port prod-local mode | Tests: rg -n 'make setup|make dev|make prod-local|bridge/.env|localhost:5173|localhost:8080' README.md
- [2026-02-09 13:31 MST] Issue #487 | Commit a869a3a | closed | Closed GitHub issue with commit/test evidence for README quick-start refresh | Tests: rg -n 'make setup|make dev|make prod-local|bridge/.env|localhost:5173|localhost:8080' README.md
- [2026-02-09 13:31 MST] Issue #n/a | Commit a869a3a | implementation-complete | All planned Spec116 issues (#478-#487) implemented, pushed, and closed on branch codex/spec-116-local-install-blockers; PR #488 updated | Tests: see per-issue execution log entries
- [2026-02-09 13:31 MST] Issue #n/a | Commit a869a3a | moved-to-needs-review | Moved spec 116 from 02-in-progress to 03-needs-review pending external reviewer sign-off | Tests: n/a
- [2026-02-09 18:31 MST] Issue #n/a | Commit n/a | moved-to-in-progress | Resumed spec 116 reviewer-required changes from 01-ready and set active implementation branch to codex/spec-116-local-install-blockers | Tests: n/a
- [2026-02-09 18:32 MST] Issue #537 | Commit n/a | created | Planned reviewer P1 rebase/conflict-resolution work unit with explicit merge-gate tests | Tests: n/a (issue creation)
- [2026-02-09 18:32 MST] Issue #538 | Commit n/a | created | Planned reviewer P3 API_URL migration for remaining frontend files with explicit tests | Tests: n/a (issue creation)
- [2026-02-09 18:32 MST] Issue #539 | Commit n/a | created | Planned reviewer P3 useWebSocket API URL strategy/coverage work unit with explicit tests | Tests: n/a (issue creation)
- [2026-02-09 18:37 MST] Issue #537 | Commit 30b6203 | committed+pushed | Rebased spec-116 line onto origin/main and resolved reviewer conflicts in ProjectIssuesList.tsx and AgentDetailPage.test.tsx; published rebased line on branch codex/spec-116-local-install-blockers-r2 | Tests: git merge origin/main --no-commit --no-ff; go vet ./...; go build ./...; cd web && npx vitest run
- [2026-02-09 18:37 MST] Issue #538 | Commit 012eddc | committed+pushed | Migrated remaining non-websocket local VITE_API_URL declarations to centralized API_URL imports in GitHubSettings/useEmissions/useExecApprovals/GlobalSearch | Tests: rg -n "const (API_URL|API_BASE) = import\.meta\.env\.VITE_API_URL" web/src/pages/settings/GitHubSettings.tsx web/src/hooks/useEmissions.ts web/src/hooks/useExecApprovals.ts web/src/components/GlobalSearch.tsx; cd web && npx vitest run src/pages/settings/GitHubSettings.test.tsx src/hooks/useEmissions.test.ts; cd web && npx vitest run
- [2026-02-09 18:37 MST] Issue #539 | Commit 2caa50e | committed+pushed | Updated useWebSocket to consume centralized API_URL while preserving HTTP->WS conversion logic | Tests: cd web && npx vitest run src/hooks/__tests__/useWebSocket.test.ts; rg -n "VITE_API_URL" web/src
- [2026-02-09 18:37 MST] Issue #n/a | Commit 2caa50e | pr-opened | Opened draft PR #540 from codex/spec-116-local-install-blockers-r2 to main for reviewer visibility (supersedes stale PR branch path) | Tests: n/a
- [2026-02-09 18:37 MST] Issue #537 | Commit 30b6203 | closed | Closed reviewer rebase/conflict issue with commit/test evidence in GitHub | Tests: git merge origin/main --no-commit --no-ff; go vet ./...; go build ./...; cd web && npx vitest run
- [2026-02-09 18:37 MST] Issue #538 | Commit 012eddc | closed | Closed API_URL cleanup issue with commit/test evidence in GitHub | Tests: rg -n "const (API_URL|API_BASE) = import\.meta\.env\.VITE_API_URL" web/src/pages/settings/GitHubSettings.tsx web/src/hooks/useEmissions.ts web/src/hooks/useExecApprovals.ts web/src/components/GlobalSearch.tsx; cd web && npx vitest run src/pages/settings/GitHubSettings.test.tsx src/hooks/useEmissions.test.ts; cd web && npx vitest run
- [2026-02-09 18:37 MST] Issue #539 | Commit 2caa50e | closed | Closed useWebSocket API_URL strategy issue with commit/test evidence in GitHub | Tests: cd web && npx vitest run src/hooks/__tests__/useWebSocket.test.ts; rg -n "VITE_API_URL" web/src
- [2026-02-09 18:37 MST] Issue #n/a | Commit 2caa50e | implementation-complete | Completed all reviewer-required changes for spec 116 and reran full validation gate on current branch | Tests: go vet ./...; go build ./...; cd web && npx vitest run
- [2026-02-09 18:38 MST] Issue #n/a | Commit 2caa50e | moved-to-needs-review | Moved spec 116 from 02-in-progress to 03-needs-review after completing reviewer-required fixes and opening PR #540 | Tests: n/a
- [2026-02-09 18:39 MST] Issue #n/a | Commit n/a | pr-updated | Closed superseded PR #488 after opening PR #540 to keep reviewer queue aligned to the active branch | Tests: n/a
